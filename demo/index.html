<!DOCTYPE html>
<html>
    <head>
    	<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<script src="https://github.com/neonux/requestAnimationFrame.js/raw/master/requestAnimationFrame.js"></script>
		<script src="https://github.com/mrdoob/three.js/raw/master/build/Three.js"></script>
        <script src="../src/AniConstants.js"></script>
        <script src="../src/easing/Easing.js"></script>
        <script src="../src/easing/Linear.js"></script>
        <script src="../src/AniUtil.js"></script>
        <script src="../src/AniCore.js"></script>
        <script src="../src/AniSequence.js"></script>
        <script src="../src/Ani.js"></script>
        <script type="text/javascript">
            var camera, scene, projector, renderer,
    		    info, mouse = { x: 0, y: 0 }, sun, cube,
                seq;

			var bounce = 0;

            window.onload = function(){
                info = document.getElementById("info");
                seq = new Ani.AniSequence();

                var container = document.createElement("div");
    			document.body.appendChild(container);

				camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 1, 10000);
				camera.position.z = -500;

				scene = new THREE.Scene();

				projector = new THREE.Projector();

				renderer = new THREE.WebGLRenderer();
				renderer.setSize(window.innerWidth, window.innerHeight);
				container.appendChild(renderer.domElement);

				var ambientLight = new THREE.AmbientLight(0x606060);
				scene.add(ambientLight);

				sun = new THREE.DirectionalLight(0xffffff);
				sun.position = camera.position.clone();
				scene.add(sun);

				createCube(200, new THREE.Vector3(0,0,0));

                seq.beginSequence();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:100"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:2.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:2.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:500"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:2.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:2.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:1000"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:100"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:2.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:2.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:3000"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:100"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:5.5,y:5.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:5.5,y:5.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:500"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:100"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:100"}));
                seq.endStep();

                seq.beginStep();
                seq.add(Ani.Ani.to({target: cube.rotation, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: cube.position, duration: 5, fieldName: "x:0.5,y:0.5"}));
                seq.add(Ani.Ani.to({target: window, duration: 5, fieldName: "bounce:100"}));
                seq.endStep();

                seq.endSequence();

                seq.start();
				animate();
            };

            function createCube(s, p) {
    			cube = new THREE.Mesh(
					new THREE.CubeGeometry(s, s, s),
					new THREE.MeshLambertMaterial({color: 0x003300})
				);

				cube.position = p;
				scene.add(cube);

				THREE.Collisions.colliders.push(THREE.CollisionUtils.MeshOBB(cube));
			};

            function animate() {

    			requestAnimationFrame(animate);

                Ani.update();
                info.innerHTML = "bounce: "+bounce+", <br/>cube.rotation.x: "+cube.rotation.x+", <br/>cube.rotation.y: "+cube.rotation.y;
				var vector = new THREE.Vector3(mouse.x, mouse.y, 0.5);
				projector.unprojectVector(vector, camera);

				var ray = new THREE.Ray(camera.position, vector.subSelf( camera.position ).normalize());

				var c = THREE.Collisions.rayCastNearest(ray);

				if (c) {
					c.mesh.materials[0].color.setHex(0xaa0000);
				} else {
					cube.materials[0].color.setHex( 0x003300 );
				}


				//cube.position.x = Math.sin(bounce) * 100;

				camera.lookAt(scene.position);

				renderer.render(scene, camera);

			};
        </script>
		<title>Ani demo</title>
	</head>
	<body>
        <div id="info"></div>
	</body>
</html>